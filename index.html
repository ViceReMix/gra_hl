<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Performance Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <header>
        <h1>Trading Performance Dashboard</h1>
        <p id="last-updated">Last updated: Loading...</p>
    </header>
    
    <main>
        <div class="dashboard-container">
            <div class="metrics-card">
                <h2>Performance Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric">
                        <span class="metric-label">Win Rate</span>
                        <span id="win-rate" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Trades</span>
                        <span id="total-trades" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Profit Factor</span>
                        <span id="profit-factor" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg Win</span>
                        <span id="avg-win" class="metric-value">-</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <h2>Cumulative PnL</h2>
                <div id="pnl-chart" class="chart"></div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>Trading Dashboard - Powered by Plotly.js and GitHub Pages</p>
    </footer>
    
    <script>
        // Embedded trading data
        const tradingData = {
          "last_updated": "2025-09-04 13:50:00",
          "strategies": {
            "Signals": {
              "total": {
                "total_trades": 2,
                "win_rate": 100.0,
                "avg_win": 4.692016787251621,
                "avg_loss": 0,
                "max_profit": 5.3154946183953005,
                "max_drawdown": 4.068538956107941,
                "risk_reward_ratio": Infinity,
                "returns_mean": 4.692016787251621,
                "returns_skew": NaN,
                "avg_duration": 13.987477502499999,
                "winners_risk_ratio": NaN,
                "losers_risk_ratio": 0,
                "winners_leverage": 1.0,
                "losers_leverage": 0,
                "avg_position_size": 385.6,
                "avg_notional_value": 141.113024,
                "long_trades_percent": 100.0,
                "short_trades_percent": 0.0,
                "long_win_rate": 100.0,
                "short_win_rate": 0,
                "avg_win_usd": 7.113264000000004,
                "avg_loss_usd": 0,
                "total_profit_usd": 14.226528000000007,
                "total_loss_usd": 0,
                "profit_factor": Infinity,
                "expectancy_usd": 7.113264000000004,
                "equity_weighted_return": 0.07105687197097679,
                "cumulative_pnl_chart": [
                  {
                    "cumulative_pnl": 6.083616000000012,
                    "timestamp": "2025-09-02 01:50:00+00:00"
                  },
                  {
                    "cumulative_pnl": 14.226528000000007,
                    "timestamp": "2025-09-03 13:45:00+00:00"
                  }
                ]
              }
            }
          }
        };

        // Format numbers for display
        function formatNumber(num, decimals = 2) {
            if (num === null || num === undefined || isNaN(num)) return '-';
            if (num === Infinity || num === 'Infinity') return 'âˆž';
            if (num === 0) return '0';
            
            return Number(num).toLocaleString(undefined, {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }

        // Format percentage
        function formatPercent(num) {
            if (num === null || num === undefined || isNaN(num)) return '-';
            return `${formatNumber(num, 1)}%`; // Note: real data already has percentages
        }

        // Add positive/negative class based on value
        function addValueClass(element, value) {
            if (value > 0) {
                element.classList.add('positive');
            } else if (value < 0) {
                element.classList.add('negative');
            }
        }

        // Update metrics display
        function updateMetricsDisplay(metrics) {
            // Update last updated timestamp
            const lastUpdated = document.getElementById('last-updated');
            lastUpdated.textContent = `Last updated: ${metrics.last_updated}`;
            
            // Get signals data - we're using 'total' position type for main metrics
            const signalsData = metrics.strategies.Signals.total;
            
            // Update metrics
            const winRate = document.getElementById('win-rate');
            winRate.textContent = formatPercent(signalsData.win_rate);
            addValueClass(winRate, signalsData.win_rate - 50); // Above 50% is positive
            
            const totalTrades = document.getElementById('total-trades');
            totalTrades.textContent = signalsData.total_trades;
            
            const profitFactor = document.getElementById('profit-factor');
            profitFactor.textContent = formatNumber(signalsData.profit_factor);
            addValueClass(profitFactor, signalsData.profit_factor - 1); // Above 1 is positive
            
            const avgWin = document.getElementById('avg-win');
            avgWin.textContent = formatNumber(signalsData.avg_win);
            addValueClass(avgWin, signalsData.avg_win);
        }

        // Create PnL chart
        function createPnLChart(metrics) {
            const pnlData = metrics.strategies.Signals.total.cumulative_pnl_chart;
            
            if (!pnlData || pnlData.length === 0) {
                document.getElementById('pnl-chart').innerHTML = '<p class="no-data">No PnL data available</p>';
                return;
            }
            
            // Prepare data for Plotly
            const x = pnlData.map(point => point.timestamp);
            const y = pnlData.map(point => point.cumulative_pnl);
            
            // Create the trace
            const trace = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Cumulative PnL',
                line: {
                    color: '#4ade80',
                    width: 2
                },
                marker: {
                    size: 6,
                    color: '#4ade80'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(74, 222, 128, 0.1)'
            };
            
            // Layout configuration
            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                margin: { t: 10, r: 10, b: 40, l: 50 },
                xaxis: {
                    title: 'Date',
                    gridcolor: 'rgba(255,255,255,0.1)',
                    tickfont: { color: '#fde2f3' }
                },
                yaxis: {
                    title: 'Cumulative PnL (USD)',
                    gridcolor: 'rgba(255,255,255,0.1)',
                    tickfont: { color: '#fde2f3' },
                    tickprefix: '$'
                },
                showlegend: false,
                hovermode: 'closest'
            };
            
            // Config options
            const config = {
                responsive: true,
                displayModeBar: false
            };
            
            // Create the chart
            Plotly.newPlot('pnl-chart', [trace], layout, config);
        }

        // Initialize dashboard with embedded data
        function initDashboard() {
            try {
                updateMetricsDisplay(tradingData);
                createPnLChart(tradingData);
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                document.body.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #f87171;">
                        <h2>Error Loading Dashboard</h2>
                        <p>${error.message || 'Unknown error occurred'}</p>
                        <p>Please check the console for more details.</p>
                    </div>
                `;
            }
        }

        // Start the dashboard when the page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
